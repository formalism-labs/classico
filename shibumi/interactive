
# Interactive functions

#----------------------------------------------------------------------------------------------

eset() {
	read -r -e -p "$1=" -i "${!1}" "$1"
}

#----------------------------------------------------------------------------------------------

etmp() {
	local f=$(mktemp /tmp/et.XXXXXX)
	vim $f
	echo $f
}

#----------------------------------------------------------------------------------------------

var() {
	declare -F -p $1 2>/dev/null 1>&2
	if [[ $? == 0 ]]; then
		declare -f -p $1
	else
		declare -p $1
	fi
}

#----------------------------------------------------------------------------------------------

ppath() {
	local n=$1
	[[ -z $n ]] && n=PATH
	local v="${!n}"
	echo "${v//\:/$'\n'}"
}

#----------------------------------------------------------------------------------------------

title() {
	[[ -z "$1" ]] || PS1_TITLE="$1"
}

#----------------------------------------------------------------------------------------------

spin_while() {
	local cmd="$@"
	if [[ -n $TEXT ]]; then
		local text="$TEXT"
	else
		local text="Working..."
	fi

	{
		spin='-\|/'
		local i=0
		tput civis
		while true; do
			i=$(( (i+1) % 4 ))
			printf "\r[%c] $TEXT" "${spin:$i:1}"
			sleep 0.1
		done
	} &
	local spinner_pid=$!

	{ $cmd; }

	kill $spinner_pid
	wait $spinner_pid 2>/dev/null
	tput cnorm
	printf "\r\033[K[âœ”] Done.\n"
}

#----------------------------------------------------------------------------------------------

export -f eset etmp var ppath
